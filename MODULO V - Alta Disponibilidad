ğŸ“˜ PrÃ¡ctica 1 â€“ SincronizaciÃ³n de Carpetas con Rsync
ğŸ”§ ConfiguraciÃ³n inicial (Servidor Primario â€” server-a)
mkdir ~/DirSync
cd ~/DirSync
touch prueba{1..100}

ğŸ” SincronizaciÃ³n hacia el servidor remoto (server-b ejemplo: 10.0.0.149)
rsync -avz /home/r20241244/DirSync/ r20241244@10.0.0.149:/home/r20241244/Dirserv2


Flags:

-a â†’ preserva permisos y estructura

-v â†’ verbose

-z â†’ compresiÃ³n

ğŸ“‚ VerificaciÃ³n en el servidor remoto (server-b)
ssh r20241244@10.0.0.149
cd /home/r20241244/Dirserv2
ls

âœï¸ Prueba de modificaciÃ³n + sincronizaciÃ³n

En server-a:

vim /home/r20241244/DirSync/prueba20
# Contenido de ejemplo:
# PROBANDO SINCRONIZACION


Sincronizar nuevamente:

rsync -avz /home/r20241244/DirSync/ r20241244@10.0.0.149:/home/r20241244/Dirserv2


Comprobar en server-b:

ssh r20241244@10.0.0.149
ls /home/r20241244/Dirserv2

ğŸ” SSH sin contraseÃ±a (automation)

En server-a:

ssh-copy-id r20241244@10.0.0.149


Crear mÃ¡s archivos y sincronizar:

touch /home/r20241244/DirSync/sinc{1..200}
rsync -avz /home/r20241244/DirSync/ r20241244@10.0.0.149:/home/r20241244/Dirserv2

ğŸ•’ AutomatizaciÃ³n con Script + Cron (server-a)

Crear script:

vim /home/r20241244/sync.sh


Contenido:

#!/bin/bash
rsync -avz /home/r20241244/DirSync/ r20241244@10.0.0.149:/home/r20241244/Dirserv2


Dar permisos:

chmod +x /home/r20241244/sync.sh


Editar crontab (ejecuciÃ³n cada minuto â€” ajustar segÃºn necesidad):

crontab -e
# AÃ±adir:
* * * * * /home/r20241244/sync.sh


Verificar en server-b que los archivos aparecen automÃ¡ticamente.

ğŸ“˜ PrÃ¡ctica 2 â€“ Cluster con Pacemaker + PCS

IPs de ejemplo para el cluster (ajusta a tu red):
server-a = 10.0.0.148
server-b = 10.0.0.149
VIP = 10.0.0.150

ğŸ”§ Habilitar repositorios necesarios (ambos nodos)
sudo dnf config-manager --set-enabled crb
sudo dnf config-manager --set-enabled highavailability

ğŸ“¡ ConfiguraciÃ³n de /etc/hosts (ambos nodos)
sudo vim /etc/hosts


Agregar lÃ­neas (ejemplo):

10.0.0.148 server-a
10.0.0.149 server-b

ğŸ›  Instalar Pacemaker y PCS (ambos nodos)
sudo dnf install pacemaker pcs -y
sudo systemctl enable pcsd --now


Firewall:

sudo firewall-cmd --add-service=high-availability --permanent
sudo firewall-cmd --reload


Crear contraseÃ±a para hacluster (misma en ambos nodos):

sudo passwd hacluster

ğŸ§© Crear y arrancar el cluster (desde uno de los nodos)

AutenticaciÃ³n entre nodos:

sudo pcs host auth server-a server-b -u hacluster -p 'CambiarPorContraseÃ±aSegura'


Crear cluster:

sudo pcs cluster setup myCluster server-a server-b
sudo pcs cluster start --all
sudo pcs cluster status

âš™ï¸ Propiedades del Cluster (para entornos de prueba)

Desactivar STONITH (solo en pruebas):

sudo pcs property set stonith-enabled=false


PolÃ­tica no quorum (Ãºtil para 2 nodos de prueba):

sudo pcs property set no-quorum-policy=ignore

ğŸŒ Crear recurso VIP
sudo pcs resource create vip ocf:heartbeat:IPaddr2 ip=10.0.0.150 cidr_netmask=24 op monitor interval=30s


Probar con ping desde un equipo cliente:

ping 10.0.0.150

ğŸ“˜ PrÃ¡ctica 3 â€“ Alta Disponibilidad HTTP con Keepalived
ğŸ”§ Instalar Apache en ambos nodos
sudo dnf install httpd -y
sudo systemctl enable httpd --now


Crear index en cada nodo:

server-a (/var/www/html/index.html):

<h1>Servidor 1 - Reymi MÃ©ndez (20241244)</h1>


server-b (/var/www/html/index.html):

<h1>Servidor 2 - Reymi MÃ©ndez (20241244)</h1>


Firewall (puerto 80):

sudo firewall-cmd --add-port=80/tcp --permanent
sudo firewall-cmd --reload

ğŸ”§ Instalar Keepalived (ambos nodos)
sudo dnf install keepalived -y


Eliminar configuraciÃ³n vieja si existe y crear la nueva:

sudo rm -f /etc/keepalived/keepalived.conf
sudo vim /etc/keepalived/keepalived.conf

ğŸ“„ keepalived.conf â€“ server-a (MASTER, IP 10.0.0.148)
vrrp_instance VI_1 {
    state MASTER
    interface ens160
    virtual_router_id 51
    priority 99
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1234
    }
    virtual_ipaddress {
        10.0.0.150
    }
}

ğŸ“„ keepalived.conf â€“ server-b (BACKUP, IP 10.0.0.149)
vrrp_instance VI_1 {
    state BACKUP
    interface ens160
    virtual_router_id 51
    priority 20
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1234
    }
    virtual_ipaddress {
        10.0.0.150
    }
}


Habilitar y arrancar:

sudo systemctl enable keepalived --now

ğŸ§ª Prueba de funcionamiento

Desde cualquier equipo de la red (o desde tu browser local si tienes ruta):

Abrir:

http://10.0.0.150


Ver cuÃ¡l servidor responde. Apagar server-a y comprobar que server-b asume la VIP automÃ¡ticamente.
